import React, { useRef, useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import ChatInterface, { ChatInterfaceHandle } from '../components/ChatInterface.tsx';

const ChatPage: React.FC = () => {
  const chatRef = useRef<ChatInterfaceHandle>(null);
  const location = useLocation();
  const state = location.state as { initialQuery?: string };

  useEffect(() => {
    if (state?.initialQuery && chatRef.current) {
      // Small delay to ensure the component is fully mounted
      const timer = setTimeout(() => {
        chatRef.current?.sendMessage(state.initialQuery!);
      }, 500);
      return () => clearTimeout(timer);
    }
  }, [state]);

  const handleQueryClick = (query: string) => {
    if (chatRef.current) {
      chatRef.current.sendMessage(query);
    }
  };

  return (
    <div className="flex-grow bg-[#fafafa] flex flex-col min-h-[calc(100vh-73px)] animate-in fade-in duration-700">
      <div className="max-w-7xl mx-auto w-full px-6 py-10 flex-grow flex flex-col lg:flex-row gap-10">
        
        {/* Sidebar: Portal Dashboard */}
        <div className="lg:w-1/4 space-y-8">
          <div className="p-8 bg-zinc-950 rounded-[40px] text-white shadow-2xl relative overflow-hidden border border-white/5">
            <div className="absolute -right-12 -top-12 w-48 h-48 bg-blue-600/20 rounded-full blur-[80px]"></div>
            <div className="relative z-10">
              <div className="flex items-center gap-3 mb-6">
                <div className="w-2.5 h-2.5 rounded-full bg-blue-500 animate-pulse"></div>
                <h2 className="text-[10px] font-black tracking-[0.3em] uppercase text-blue-400">Portal Scout</h2>
              </div>
              <h3 className="text-4xl font-black tracking-tighter uppercase mb-4 leading-none">Scout Intel</h3>
              <p className="text-zinc-400 serif-text italic text-lg leading-snug">
                The definitive high-desert companion for trail discovery and recovery protocols.
              </p>
            </div>
          </div>
          
          <div className="p-8 bg-white border border-zinc-200 rounded-[40px] shadow-sm">
             <h4 className="text-[10px] font-black uppercase tracking-[0.3em] text-[#0d47a1] mb-8">Vetted Quick Queries</h4>
             <ul className="space-y-6">
               {[
                 { q: "How do I setup my Sage subdomain?", icon: "ðŸŒ" },
                 { q: "Find Sedona recovery retreats", icon: "ðŸ§˜" },
                 { q: "Help me build a 3-day vacation", icon: "âœˆï¸" },
                 { q: "Are there hidden trail pools nearby?", icon: "ðŸ’§" },
                 { q: "Explain the GHL Community sync", icon: "ðŸ”—" }
               ].map((item, i) => (
                 <li 
                   key={i} 
                   onClick={() => handleQueryClick(item.q)}
                   className="group cursor-pointer flex items-center gap-4 hover:translate-x-2 transition-all"
                 >
                   <span className="text-xl grayscale group-hover:grayscale-0 transition-all">{item.icon}</span>
                   <span className="text-[13px] font-bold text-zinc-500 group-hover:text-[#0d47a1] leading-tight">
                     {item.q}
                   </span>
                 </li>
               ))}
             </ul>
          </div>

          <div className="p-6 bg-blue-50/50 border border-blue-100 rounded-2xl">
            <p className="text-[9px] font-black text-[#0d47a1] uppercase tracking-[0.2em] leading-relaxed text-center">
              * Powered by Google Search Grounding for real-time trail accuracy.
            </p>
          </div>
        </div>

        {/* Main Scout Console */}
        <div className="lg:w-3/4 flex-grow flex flex-col bg-white border border-zinc-200 rounded-[48px] overflow-hidden shadow-2xl shadow-blue-900/10 transition-all">
           <ChatInterface 
             ref={chatRef}
             className="h-full border-none" 
             initialMessage="Identity Verified. Scout Online. Monitoring SageSuite directory nodes and Arizona trail alerts. What intelligence do you require?" 
           />
        </div>
      </div>
    </div>
  );
};

export default ChatPage;
  );
};

export default ChatPage;
